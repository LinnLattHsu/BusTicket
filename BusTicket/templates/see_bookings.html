<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Your Bookings - MyBusTicket</title>
    <!-- Required meta tags -->
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap 5.3.x CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">

    <!-- Font Awesome 6.1.1 CDN -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css">

    <!-- Favicon -->
    <link rel="icon"
        href="https://media.istockphoto.com/id/1316056069/vector/regional-transport-abstract-concept-vector-illustration.jpg?s=612x612&w=0&k=20&c=puRU0uK1Xr18a3_3m-0bnCpUbgu-Q5Po02EK_goVIdY=">

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8f9fa; /* A subtle light grey background for the body */
        }
        .navbar {
            background-color: rgb(30, 58, 138) !important;
        }
        .navbar-brand img {
            height: 50px;
            width: 50px;
            border-radius: 10px;
        }
        .nav-link {
            color: white;
            display: flex; /* Use flex for icon and text alignment */
            align-items: center;
            gap: 5px; /* Space between icon and text */
        }
        .nav-link:hover {
            color: rgba(255, 255, 255, 0.75);
        }
        .nav-item.active .nav-link {
            font-weight: bold;
        }
        .profile-dropdown-container {
            position: relative;
            display: inline-block;
            vertical-align: middle;
        }
        .profile-circle {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            color: #007bff; /* Icon color */
            background-color: white; /* Background of the circle */
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s ease-in-out;
            border: 2px solid #007bff; /* Border color */
            font-size: 1.25rem; /* Emoji size */
        }
        .profile-circle:hover {
            transform: scale(1.05);
        }
        .profile-dropdown-menu {
            display: none;
            position: absolute;
            right: 0;
            top: 100%;
            background-color: #fff;
            min-width: 160px;
            box-shadow: 0px 8px 16px 0px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            border-radius: 8px; /* Slightly more rounded */
            overflow: hidden;
            margin-top: 10px;
        }
        .profile-dropdown-menu a {
            color: black;
            padding: 12px 16px;
            text-decoration: none;
            display: block;
        }
        .profile-dropdown-menu a:hover {
            background-color: #f1f1f1;
        }
        .show {
            display: block;
        }

        /* --- Custom styles for Booking Search and Cards --- */
        .booking-search-form {
            background-color: #fff;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            padding: 30px; /* Increased padding */
            margin-bottom: 40px; /* More space below search form */
            max-width: 800px; /* Max width for central alignment */
            margin-left: auto;
            margin-right: auto;
        }
        .booking-search-form .input-group .form-control {
            border-radius: 8px 0 0 8px; /* Rounded left side */
            height: 45px; /* Taller input */
        }
        .booking-search-form .input-group .btn {
            border-radius: 0 8px 8px 0; /* Rounded right side */
            height: 45px; /* Taller button */
        }

        .booking-card {
            background-color: #fff;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            padding: 25px;
            margin-bottom: 20px;
            transition: transform 0.2s ease-in-out;
            display: flex; /* Use flexbox for internal layout */
            align-items: center; /* Vertically align items */
        }
        .booking-card:hover {
            transform: translateY(-5px);
        }

        .booking-info-item {
            margin-bottom: 10px; /* Space between info items */
        }
        .booking-info-item .label {
            font-weight: 600;
            color: #777; /* Softer label color */
            font-size: 0.85rem;
        }
        .booking-info-item .value {
            font-weight: bold;
            color: #1e3a8a; /* Darker blue for values */
            font-size: 1rem;
        }
        .booking-card .col-lg-3.text-lg-end {
            display: flex;
            justify-content: flex-end; /* Align button to the right on larger screens */
            align-items: center;
            height: 100%; /* Ensure button column takes full height */
        }
        .btn-view-ticket {
            background-color: #0d6efd; /* Primary blue from Bootstrap */
            color: white;
            border: none;
            border-radius: 8px;
            padding: 10px 20px; /* Larger padding for button */
            transition: background-color 0.2s ease-in-out;
            white-space: nowrap; /* Prevent button text from wrapping */
        }
        .btn-view-ticket:hover {
            background-color: #0b5ed7; /* Darker blue on hover */
        }

        /* --- Detailed Ticket View Styles --- */
        .ticket-card {
            border-radius: 1.5rem; /* Increased rounding for a modern look */
            border: none;
            box-shadow: 0 1rem 2rem rgba(0, 0, 0, 0.15); /* Stronger shadow */
            overflow: hidden; /* Ensures child elements respect border-radius */
        }
        .ticket-card .card-header {
            background-image: linear-gradient(to right, #2196f3, #0d47a1); /* Blue gradient header */
            border-top-left-radius: 1.5rem; /* Match the card's border-radius */
            border-top-right-radius: 1.5rem;
            color: white; /* Ensure text is white */
        }
        .ticket-card .card-header small {
            opacity: 0.8; /* Slightly less opaque for subtitle */
        }
        .ticket-card .card-body {
            color: #343a40; /* Dark grey for body text */
        }
        .ticket-card .card-footer {
            background-color: #f8f9fa; /* Light background for footer */
            border-top: 1px solid #eee;
            border-bottom-left-radius: 1.5rem; /* Match card rounding */
            border-bottom-right-radius: 1.5rem;
        }
        .ticket-card .row.my-4.g-3 .col-md-6 {
            padding-bottom: 10px; /* Add some space below each detail item */
        }
        .past-booking {
            background-color: #f0f0f0; /* Very light grey background */
            border-left: 5px solid #ccc; /* A subtle grey left border */
            opacity: 0.8; /* Slightly desaturate */
        }
        /* Print-specific styles for clean output */
        @media print {
        body > *:not(.print-only) {
        display: none !important;
    }

    /* 2. Position the ticket content to the top of the page */
    .print-only {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        margin: 0;
        padding: 0;
    }

    /* 3. Refine the ticket-card styles for clean printing */
    .ticket-card {
        box-shadow: none !important; /* Remove shadows for a cleaner look */
        border: 1px solid #ccc; /* Add a subtle border */
        border-radius: 0 !important; /* Remove rounded corners */
        width: 100%;
        max-width: 100%;
    }

    /* 4. Remove elements from the ticket itself that you don't want to print */
    .card-footer, .navbar {
        display: none !important;
    }

    /* 5. Force text to be black for readability */
    body, p, h1, h2, h3, h4, h5, h6, .card-header, .card-body {
        color: #000 !important;
    }
    .text-secondary {
        color: #555 !important;
    }

    /* 6. Ensure the card fits on one page */
    @page {
        size: A4 portrait;
        margin: 1cm;
    }
    }

    </style>
</head>
<body>

<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-dark bg-primary">
    <div class="container">
        <a class="navbar-brand" href="{% url 'home' %}">
            <img src="https://i.pinimg.com/originals/e2/1c/b5/e21cb58cda4ccf597b05d2048b483c0d.jpg" alt="Logo">
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavAltMarkup"
            aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse justify-content-end" id="navbarNavAltMarkup">
            <div class="navbar-nav">
                <a class="nav-item nav-link {% if active_page == 'home' %}active{% endif %}" href="{% url 'home' %}">
                    <i class="fas fa-home"></i> Home
                </a>
                <a class="nav-item nav-link {% if active_page == 'about_us' %}active{% endif %}" href="{% url 'about_us' %}">
                    <i class="fas fa-bus"></i> About Us
                </a>
                {% if request.user.is_authenticated %}
                <a class="nav-item nav-link {% if active_page == 'seebookings' %}active{% endif %}" href="{% url 'seebookings' %}">
                    <i class="fas fa-ticket-alt"></i> See Bookings
                </a>
                <a class="nav-item nav-link {% if active_page == 'feedback' %}active{% endif %}" href="{% url 'feedback' %}">
                    <i class="fas fa-comment-alt"></i> Feedback
                </a>
                <a class="nav-item nav-link {% if active_page == 'contact' %}active{% endif %}" href="{% url 'contact_us' %}">
                    <i class="fas fa-envelope"></i> Contact Us
                </a>
                <div class="profile-dropdown-container">
                    <div class="profile-circle ms-2 me-2" onclick="toggleDropdown()">&#x1F464;</div>
                    <div class="profile-dropdown-menu" id="profileDropdown">
                        <a href="{% url 'profile_page' %}">Your Profile</a>
                        <a href="{% url 'logout' %}">Logout</a>
                    </div>
                </div>
                {% else %}
                <a class="nav-item nav-link" href="{% url 'login' %}">
                    <i class="fas fa-sign-in-alt"></i> Login
                </a>
                <a class="nav-item nav-link" href="{% url 'register' %}">
                    <i class="fas fa-user-plus"></i> Signup
                </a>
                {% endif %}
            </div>
        </div>
    </div>
</nav>

<div class="container py-5 print-only">
    {% if booking %}
    <!-- --- Detailed Ticket View --- -->
    <div class="row justify-content-center">
        <div class="col-12 col-md-8 col-lg-7">
            <div class="card ticket-card shadow-lg">
                <div class="card-header text-white text-center py-4">
                    <h4 class="mb-0 fs-4 fw-bold">{{ booking.schedule.bus.operator.operator_name }}</h4>
                    <small class="text-uppercase fw-bolder fs-6">{{ booking.schedule.bus.bus_type }}</small>
                </div>
                <div class="card-body p-4">
                    <!-- Route and Date -->
                    <div class="row text-center my-4 g-3 border-bottom pb-4">
                        <div class="col-12 col-md-6">
                            <p class="mb-0 text-muted small">From</p>
                            <h3 class="fw-bold fs-3">{{ booking.schedule.route.origin }}</h3>
                        </div>
                        <div class="col-12 col-md-6">
                            <p class="mb-0 text-muted small">To</p>
                            <h3 class="fw-bold fs-3">{{ booking.schedule.route.destination }}</h3>
                        </div>
                    </div>

                    <!-- Details -->
                    <div class="row my-4 g-3">
                        <div class="col-12 col-md-6">
                            <p class="mb-0 fw-bold">Travel Date</p>
                            <p class="text-secondary">{{ booking.schedule.date|date:"F d, Y" }}</p>
                        </div>
                        <div class="col-12 col-md-6">
                            <p class="mb-0 fw-bold">Departure Time</p>
                            <p class="text-secondary">{{ booking.schedule.time|time:"h:i A" }}</p>
                        </div>
                        <div class="col-12 col-md-6">
                            <p class="mb-0 fw-bold">Passenger Name</p>
                            <p class="text-secondary">{{ booking.customer.name }}</p>
                        </div>
                        <div class="col-12 col-md-6">
                            <p class="mb-0 fw-bold">Seats</p>
                            <p class="text-secondary">{{ booking.seat_numbers }}</p>
                        </div>
                        <div class="col-12 col-md-6">
                            <p class="mb-0 fw-bold">Total Price</p>
                            <p class="text-secondary">MMK {{ booking.ticket.total_amount }}</p>
                        </div>
                        <div class="col-12 col-md-6">
                            <p class="mb-0 fw-bold">Booking ID</p>
                            <p class="text-secondary">{{ booking.id }}</p>
                        </div>
                        <div class="col-12 col-md-6">
                            <p class="mb-0 fw-bold">Payment Method</p>
                            <p class="text-secondary">{{ booking.ticket.payment.get_payment_method_display }}</p>
                        </div>
                        <div class="col-12 col-md-6">
                            <p class="mb-0 fw-bold">Booking Date</p>
                            <p class="text-secondary">{{ booking.booked_time|date:"F d, Y H:i" }}</p>
                        </div>
                    </div>

                    <hr class="my-4">

                    <!-- QR Code and Status -->
                    <div class="row text-center flex-column flex-md-row justify-content-center align-items-center">
                        <div class="col-12 col-md-6 mb-4 mb-md-0">
                            <div class="bg-light p-3 rounded">
                                <p class="mb-2 text-muted small">Scan to verify</p>
                                <img src="https://api.qrserver.com/v1/create-qr-code/?data={{ booking.customer.name }}, {{ booking.schedule.route.origin }}, {{ booking.schedule.route.destination }}, {{ booking.schedule.date }}, {{ booking.schedule.time }}&size=150x150" alt="QR Code" class="img-fluid" style="max-width: 150px;">
                            </div>
                        </div>
                        <div class="col-12 col-md-6 d-flex flex-column align-items-center">
                            <p class="mb-1 fw-bold fs-6">Status</p>
                            <span class="badge bg-success fs-4 py-2 px-3 rounded-pill">Confirmed</span>
                        </div>
                    </div>
                </div>
                <div class="card-footer d-flex flex-column flex-md-row justify-content-between py-3">
                    <a href="{% url 'seebookings' %}" class="btn btn-secondary mb-2 mb-md-0 d-block d-md-inline-block w-100 w-md-auto">
                        <i class="fas fa-arrow-left me-2"></i>Back to List
                    </a>
                    <button class="btn btn-info text-white d-block d-md-inline-block w-100 w-md-auto" onclick="window.print()">
                        <i class="fas fa-print me-2"></i>Print Ticket
                    </button>
                </div>
            </div>
        </div>
    </div>
    {% else %}
    <!-- --- Booking List View --- -->
    <h2 class="text-center mb-5 text-dark">Your Bookings</h2>

    <!-- Search Form for Booking ID -->
    <div class="booking-search-form">
        <form method="get" action="{% url 'seebookings' %}">
            <h5 class="text-center mb-4 text-primary">Find Your Ticket</h5>
            <div class="input-group">
                <input type="text" name="booking_id" class="form-control" placeholder="Enter Booking ID..." value="{{ request.GET.booking_id|default:'' }}">
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-search me-1"></i> Search
                </button>
            </div>
        </form>
    </div>
            {% if bookings %}
        {% for booking in bookings %}
            {# Compare booking date with today's date #}
            {% comment %}
                Ensure 'booking.schedule.date' is a date object for proper comparison.
                Django's 'now' tag returns a datetime object.
                If 'booking.schedule.date' is just a date, you might need to compare it
                with today's date component of 'now'.
            {% endcomment %}
            {% now "Y-m-d" as today_date_str %}
            {% if booking.schedule.date|date:"Y-m-d" < today_date_str %}
                <div class="booking-card row align-items-center past-booking"> {# Apply past-booking class here #}
            {% else %}
                <div class="booking-card row align-items-center">
            {% endif %}
                <!-- Left Side: Basic Info -->
                <div class="col-12 col-md-6 col-lg-5">
                    <div class="booking-info-item">
                        <div class="label">Trip:</div>
                        <div class="value">{{ booking.schedule.route.origin }} &rarr; {{ booking.schedule.route.destination }}</div>
                    </div>
                    <div class="booking-info-item">
                        <div class="label">Travel Date:</div>
                        <div class="value">{{ booking.schedule.date|date:"F j, Y" }}</div>
                    </div>
                </div>

                <!-- Middle: Detailed Info -->
                <div class="col-12 col-md-6 col-lg-4">
                    <div class="booking-info-item">
                        <div class="label">Seats:</div>
                        <div class="value">{{ booking.seat_numbers }}</div>
                    </div>
                    <div class="booking-info-item">
                        <div class="label">Amount:</div>
                        <div class="value">MMK {{ booking.ticket.total_amount }}</div>
                    </div>
                    <div class="booking-info-item">
                        <div class="label">Booking ID:</div>
                        <div class="value">{{ booking.id }}</div>
                    </div>
                </div>

                <!-- Right Side: Actions -->
                <div class="col-12 col-lg-3 text-lg-end mt-3 mt-lg-0">
                    <a href="{% url 'seebookings_detail' booking_id=booking.id %}" class="btn btn-view-ticket w-100">
                        <i class="fas fa-eye me-2"></i> View Ticket
                    </a>
                </div>
            </div>
        {% endfor %}
    {% else %}
        <div class="alert alert-info text-center mt-5 p-4 rounded-3 shadow-sm" role="alert">
            <h4 class="alert-heading">No Tickets Found!</h4>
            <p>It looks like you haven't bought any tickets yet or your search returned no results.</p>
            <hr>
            <p class="mb-0">Start your journey by booking a ticket <a href="{% url 'home' %}" class="alert-link">here</a>.</p>
        </div>
    {% endif %}
{% endif %}

</div>

<!-- Bootstrap 5.3.x JS Bundle -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1Z7b1mC+07hF3z0J625Q4rXq+8Qd6T"
    crossorigin="anonymous"></script>

<script>
    function toggleDropdown() {
        document.getElementById("profileDropdown").classList.toggle("show");
    }

    window.onclick = function(event) {
        if (!event.target.matches('.profile-circle') && !event.target.matches('.profile-circle span')) {
            var dropdowns = document.getElementsByClassName("profile-dropdown-menu");
            for (var i = 0; i < dropdowns.length; i++) {
                var openDropdown = dropdowns[i];
                if (openDropdown.classList.contains('show')) {
                    openDropdown.classList.remove('show');
                }
            }
        }
    }
</script>

</body>
</html>